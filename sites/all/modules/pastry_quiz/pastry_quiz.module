<?php
/**
 * @file
 * Present Questions on different pages and provide final food suggestion
 */

/**
 * Define our name space and fields in $_SESSION
 */
define('QUIZ', 'pastry_quiz_module');
define('GLUTEN_INTOLERANT', 'gluten_intolerant');

/**
 * Implements hook_menu().
 */
function pastry_quiz_menu() {
  $items['quiz'] = array(
    'title' => 'What should I eat!?',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('question_1_form'),
    'access callback' => TRUE,
    'type' => MENU_NORMAL_ITEM,
  );

  $items['quiz_results'] = array(
    'title' => 'Quiz Results!',
    'page callback' => 'quiz_success',
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  return $items;
}


/**
 * Creates a Form
 */
function question_1_form() {
  $form['gluten'] = array(
    '#title' => 'Gluten Intolerance',
    '#type' => 'radios',
    '#description' => t('Are you gluten intolerant?'),
    '#options' => array(
      '1' => t('Yes'),
      '0' => t('No'),
    ),
    '#required' => TRUE,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Submit',
  );

  return $form;
}

/*
 * hook_form_submit
 */
function question_1_form_submit($form, &$form_state) {
  $_SESSION[QUIZ][GLUTEN_INTOLERANT] = (int) $form_state['values']['gluten'];
  $form_state['redirect'] = 'quiz_results';
}


/*
 * Output final result of Quiz
 */
function quiz_success() {
  $gluten_free = '';
  if ($_SESSION[QUIZ][GLUTEN_INTOLERANT]) {
    $gluten_free .= 'gluten free';
  }

  return <<<EOD
    <p>Get a $gluten_free donut!</p>
    <p>And while you're here, check out our other fresh $gluten_free pastries!</p>
EOD;
}
